generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      UserRole @default(NGO)
  status    UserStatus @default(PENDING)

  // Web3 Authentication fields
  walletAddress String?  @unique
  nonce         String?
  nonceIssuedAt DateTime?
  nonceExpiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ngos      NGO[]
}

model NGO {
  id                       String   @id @default(cuid())
  organizationName         String
  yearEstablished          Int
  countryOfOperation       String
  ngoIdentificationNumber  String
  emailAddress             String
  missionStatement         String
  websiteOrSocialLinks     String

  // Contact Person fields
  contactPersonName           String?
  contactPersonPosition       String?
  contactPersonPhoneNumber    String?
  contactPersonResidentialAddress String?
  contactPersonEmailAddress   String?

  // Organization Document fields
  orgCountryOfOperation   String?
  orgEmailAddress         String?
  orgDescription          String?
  orgImages               String[]

  // Wallet field
  connectedWallet         String?
  statusVerification      NGOStatus @default(PENDING)

  // Relation to User
  user       User    @relation(fields: [userId], references: [id])
  userId     String

  // Relation to Projects
  projects   Project[] @relation("NGOProjects")
}

model Project {
  id           String        @id @default(cuid())
  title        String
  description  String
  images       String[]
  fundingGoal  Float
  raisedAmount Float         @default(0)
  status       ProjectStatus @default(PENDING)
  metadataHash String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  // Foreign keys
  creatorId    String
  locationId   String?       @unique

  // Relations
  creator      NGO           @relation("NGOProjects", fields: [creatorId], references: [id], onDelete: Cascade)
  location     Location?     @relation(fields: [locationId], references: [id])

  @@index([status])
  @@index([creatorId])
  @@index([createdAt])
}
//

model Location {
  id        String   @id @default(cuid())
  address   String
  city      String
  state     String
  country   String
  latitude  Float?
  longitude Float?
  project   Project?

  @@index([city])
  @@index([state])
}

model Otp {
    id        String   @id @default(cuid())
    email     String
    code      String
    expiresAt DateTime 
}

enum UserStatus {
  PENDING
  APPROVED
}
enum NGOStatus {
  PENDING
  APPROVED
  REJECTED
}
enum ProjectStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum UserRole {
  USER
  ADMIN
  NGO
}
